---
title: "Topic 1: Project organisation"
author: "Emma Rand"
output:
  html_document:
    toc: true
    depth: 3
    toc_float:
      collapsed: false
      smooth_scroll: false
    theme: flatly
  word_document: default
---


![](../pics/58M.png)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.5442490.svg)](https://doi.org/10.5281/zenodo.5442490)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

```{r include=FALSE}
library(RefManageR)
```


```{r, load-refs, include=FALSE, cache=FALSE}
BibOptions(check.entries = FALSE,
           bib.style = "authoryear",
           cite.style = "authoryear",
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE,
           longnamesfirst = FALSE,
           max.names = 2)
myBib <- ReadBib("../refs.bib", check = FALSE)
```

# Week Overview

## Aim
The aim of this week is to introduce you to RStudio Projects and good practices for organising work. 
## Objectives
By the end of this week the successful student should be able to:
-  Use an RStudio project with structured directories and documentation to organise their work
-  develop a convention for naming files and directories which is machine and human readable

# Task 1 New RStudio Project

This exercise allows you go through the new RStudio Project with **`usethis`** `r Cite(myBib, "usethis")` workflow. 

The data in [chaff.txt](../data-raw/chaff.txt) are the masses of male and female chaffinches. They are organised as two columns, `males` and `females`, a format which is not ideal. Your task is to organise an analysis of these data in an RStudio Project.

1. First check your working directory with `getwd()` and determine what path you need to create the RStudio Project in a place that suits you.

2. Create the RStudio Project with:

```{r eval=FALSE}
usethis::create_project("chaffinches")
```
   
3. Add a README with:

```{r eval=FALSE}
usethis::use_readme_md()
```

   Add some text to the README about the data and analysis. You can continue to edit this as you work.

4. Add a LICENSE with:

```{r eval=FALSE}
usethis::use_ccby_license()
```

5. Add directories to structure the analysis - you may wish to revise this as you work. I suggest adding `data-raw` and `data-processed`

6. Save a copy of [chaff.txt](../data-raw/chaff.txt) to `data-raw`

7. Make a script called `01-import.R`. There is a **`usethis`** helper function for that purpose if you wish:
```{r eval=FALSE}
usethis::use_r("01-import")
```

`usethis::use_r()` helpfully adds the R extension and creates the file in the `R/` directory

We will now add code to import and reformat the data as 'tidy' `r Cite(myBib, "Wickham2014-nl")`, then write the reformatted data to file. Tidy means there is one column giving the sex and another giving the mass

8. Load the `tidyverse` `r Cite(myBib, "Wickham2019-ml")` and import:  
```{r eval=FALSE}
file <-  "../daw-processed/chaff2.txt"
```

9. Reformat as tidy: 
```{r eval=FALSE}
file <-  "../daw-processed/chaff2.txt"
write.table(chaff2, 
            file, 
            quote = FALSE,
            row.names = FALSE)
```

8. Import 
```{r eval=FALSE}
file <-  "../daw-processed/chaff2.txt"
write.table(chaff2, 
            file, 
            quote = FALSE,
            row.names = FALSE)
```

5. Summarise and analyse the data testing whether there is a difference in mass between male and female chaffinches

6. Stage and commit all the changes you have made using an appropriate commit message. 

7. Create a report-worthy figure for the analysis and write it to file. A useful function for saving **`ggplot2`** figures is [`ggsave()`](https://ggplot2.tidyverse.org/reference/ggsave.html). It has arguments for the size, resolution and device for the image. Since I often make more than one figure, I might set these argument values to variables first:

```{r eval=FALSE}
# figure saving settings
units <- "in"  
fig_w <- 3.5
fig_h <- fig_w
dpi <- 300
device <- "tiff" 
```
Then write the figure to file using, for example:

```{r eval=FALSE}
ggsave("../figures/fig1.tiff",
       plot = fig1,
       device = device,
       width = fig_w,
       height = fig_h,
       units = units,
       dpi = dpi)
```

8. Stage and commit all the changes you have made using an appropriate commit message. Push your changes to GitHub

9. Reconsider the organisation of your code and project.
   * Would some pieces of code be better in their own script?  
   * Is your code well commented? Are your variable names informative? See chapters 1 and 2 of [The tidyverse style guide](https://style.tidyverse.org/) for more suggestions.  

10. Stage and commit any changes you have made using an appropriate commit message. Push your changes to GitHub

11. Go to your GitHub repo, make some changes to the README and commit them.

12. Go to back to your local repo and Pull the changes in.

<font size = "4">
`r emo::ji("exclamation_mark")` Start every work session with a pull to make sure you are up-to-date. If you are working alone or only with the original repo and one clone, it is often not needed but it is a good habit to get into early.
</font>


# Task 2 Contribute to your partner's repo

To collaborate on someone else's project you 'fork' their repo, clone it, and submit and submit a 'pull request' (a PR) to propose a change

1. Go to your partner's repo on GitHub and Fork it using the button in the top right. You now have a copy of their repo on your GitHub

2. On your GitHub repo page, copy the url of the origin repo using the green Code button as you did previously. Then go to RStudio and do File | New Project | Version Control | Git, paste in the URL Create Project. This is the same process you used to clone your own repo

3. Make some changes to the analysis. For example, you might add comments to the code, add a piece of code or alter a piece of code.

4. Stage and commit the changes you have made using an appropriate commit message. Push your changes to GitHub

5. Go to your forked copy of the repo in GitHub. You should see a message telling you "This branch is 1 commit ahead of....". Click on Pull request. Now you should be able to see the changes and also a message telling you whether the branches can be automatically merged. If they can Create a pull request. You will need to describe the changes you made.

6. Your partner now needs accept (or not!) those changes by "merge the pull request".


# The Rmd file

[Rmd file](01_project_organisation.Rmd)


Pages made with `rmarkdown` `r Cite(myBib, c("markdown1","markdown2", "markdown3"))`, `RefManageR``r Cite(myBib, "RefManageR")` 


# References 

```{r refs, echo=FALSE, results="asis"}
PrintBibliography(myBib)  
```

# Please cite as:

Emma Rand. (2021). Data Science strand of BIO00058M (v1.0). Zenodo. https://doi.org/10.5281/zenodo.5442490

![](../pics/58Mend.png)


